

-- exec FSP_SALES_PAID_ACCOUNT_GK_INVOICE SO2022000089,'1','1'
ALTER PROC [dbo].[FSP_SALES_PAID_ACCOUNT_GK_INVOICE]
@SALES_INVOICE_NO varchar(50),
@COMPANY_ID varchar(50),
@BRANCH_ID varchar(50)

AS
SELECT 
ISNULL([SALES_PAID_ACCOUNT_ID],0) as SALES_PAID_ACCOUNT_ID
      ,@SALES_INVOICE_NO as [SALES_INVOICE_NO]
     , c.ACCOUNTS_CODE
      ,ISNULL(c.PAID_AMOUNT,0) AS PAID_AMOUNT    
      ,c.DESCRIPTION
      ,ACCOUNTS_CODE
      ,ISNULL(c.TOTAL_AMOUNT,0) as TOTAL_AMOUNT
      ,ISNULL(c.PAID_AMOUNT,0) AS  AMOUNT
     
    
      
  FROM
  
  (
  select a.DESCRIPTION, a.ACCOUNTS_CODE ,b.PAID_AMOUNT,SUBSIDIARY_CODE,TOTAL_AMOUNT,
  SALES_INVOICE_NO,SALES_PAID_ACCOUNT_ID 
  
 from
 ( select DESCRIPTION,ACCOUNTS_CODE,SUBSIDIARY_CODE,BRANCH_ID,COMPANY_ID
  from
   ACCOUNTS a 
    WHERE 
   
    COMPANY_ID=@COMPANY_ID and BRANCH_ID=@BRANCH_ID
   
   ) a
   left outer join 
   (
   select PAID_AMOUNT,ACCOUNT_ID,SALES_INVOICE_NO,[SALES_PAID_ACCOUNT_ID],TOTAL_AMOUNT
   ,BRANCH_ID,COMPANY_ID
   from 
   SALES_PAID_ACCOUNT  
 WHERE 
   SALES_INVOICE_NO=@SALES_INVOICE_NO
   and COMPANY_ID=@COMPANY_ID and BRANCH_ID=@BRANCH_ID
   
  ) b 
  
  on a.ACCOUNTS_CODE = b.ACCOUNT_ID and a.COMPANY_ID=b.COMPANY_ID
  and a.BRANCH_ID = b.BRANCH_ID
  
  
  )c
   WHERE 
  -- c.SALES_INVOICE_NO=@SALES_INVOICE_NO
  -- and 
  -- c.COMPANY_ID=@COMPANY_ID and c.BRANCH_ID=@BRANCH_ID
  -- and 
   (c.SUBSIDIARY_CODE=90190120002 OR 
c.subsidiary_code=90190120003)



