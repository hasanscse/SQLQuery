USE [INVENTORY_MASTER]
GO
/****** Object:  StoredProcedure [dbo].[RESET_DATA]    Script Date: 02/23/2020 11:22:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



--exec RESET_DATA 'IBRAHIM','',''
ALTER PROC [dbo].[RESET_DATA]
@RESET_CODE VARCHAR(30),
@COMPANY_ID VARCHAR(10),
@BRANCH_ID VARCHAR(10)
--with encryption
AS

IF @RESET_CODE ='IBRAHIM' and @COMPANY_ID=''
BEGIN

delete ACCOUNT_LEDGER;
update ACCOUNTS
set ACCOUNTS_BALANCE=0,opening_balance=0,OPENING_BALANCE_FLAG=0
where 1=1;
delete ADJUSTMENT;

update BUYER_SUPPLIER_INFO
set BS_ACCOUNT_BALANCE=0,
	OPENNING_BALANCE=0
where 1=1;

delete ADJUSTMENT ;
delete [COLLECTION];
delete PAYMENT;
update PRODUCT
set STOCK_QUANTITY=0,
	PURCHASED_PRICE=0,
    TOTAL_STOCK_AMOUNT=0,
    OPENING_STOCK_QUANTITY=0,  
    OPENING_STOCK_AMOUNT=0    
where 1=1;

delete PURCHASED_PRODUCT_SERIAL;
delete PURCHASE_DETAILS;
delete PURCHASE;


delete RESTURANT_SALES_DETAILS;
delete RESTURANT_FOOD_GENERATE_DETAILS;
delete RESTURANT_FOOD_GENERATE;

delete SALES_PRODUCT_SERIAL_CANCEL;
delete SALES_OTHER_INFO;
delete SALES_PRODUCT_SERIAL;
delete SALES_DETAILS;
delete SALES;

delete from SALES_DETAILS_EDIT
delete from SALES_OTHER_INFO_EDIT
delete from SALES_PRODUCT_SERIAL_EDIT
delete from SALES_EDIT

delete from SALES_RETURN_DETAILS 
--where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_OTHER_INFO_RETURN 
--where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_RETURN_DETAILS_SERIAL 
--where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_RETURN 
--where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete from SALES_RETURN
delete from SALES_RETURN_DETAILS
delete from SALES_OTHER_INFO_RETURN
delete from SALES_RETURN_DETAILS_SERIAL


delete STOCK_TRANSFER_REQUEST_DETAILS;
delete STOCK_TRANSFER_REQUEST;

delete STOCK_TRANSFER_DETAILS_SERIAL;
delete STOCK_TRANSFER_DETAILS;
delete STOCK_TRANSFER;

delete PRODUCT_SERIAL;

delete ACCOUNTS
where MANDATORY=0;
delete ACCOUNTS
where COMPANY_ID!=1 
delete ACCOUNTS
 WHERE BRANCH_ID!=1;

DELETE DS_SERIAL_GEN
where COMPANY_ID!=1 

update DS_SERIAL_GEN
set MAX_SERIAL_NO=0;

--SELECT * FROM DS_SERIAL_GEN WHERE TABLE_NAME IN ('PRODUCT','POD','POD','PRODUCT')
--DECLARE @CODE INT
--SELECT @CODE =SUBSTRING(CAST(MAX(CAST(PRODUCT_CODE AS INT)) AS NVARCHAR(30)),4,9) FROM PRODUCT
--SELECT @CODE 
--UPDATE DS_SERIAL_GEN
--SET MAX_SERIAL_NO=@CODE
--WHERE TABLE_NAME IN ('PRODUCT','POD','POD','PRODUCT');


delete bank ;

delete BUYER_SUPPLIER_INFO where MANDATORY=0;
delete BUYER_SUPPLIER_INFO
where COMPANY_ID!=1;

delete SM_MENU_ASSIGN
where USER_ID!='king 'AND USER_ID!='datasource' and COMPANY_ID!=1;

DELETE FROM [DASHBORD_SETTINGS]
    where USER_ID!='king 'AND USER_ID!='datasource'

delete USER_PROFILE 
where COMPANY_ID!=1;

delete USER_PROFILE 
where USER_ID!='king 'AND USER_ID!='datasource'
--USER_ID not in('king');

	delete PRODUCT
	--where COMPANY_ID!=1;
	
	--delete PRODUCT
	--where BRANCH_ID!=1;

	delete PRODUCT_BRAND
	--where COMPANY_ID!=1;
	delete PRODUCT_SUBCATEGORY
	--where COMPANY_ID!=1;
	delete PRODUCT_CATEGORY
	--where COMPANY_ID!=1;
	delete PROFESSION
	where COMPANY_ID!=1

	delete ZONE
	where COMPANY_ID!=1
	delete INVOICE_NOTES
	where COMPANY_ID!=1
	delete COUNTRY
	where COMPANY_ID!=1
	delete DISTRICT
	where COMPANY_ID!=1
	delete PRODUCT_UNIT_TYPES
	where COMPANY_ID!=1

	delete ACCOUNT_SUBSIDIARY
	where COMPANY_ID!=1
	delete CONTROL_ACCOUNT
	where COMPANY_ID!=1
	
	delete EMPLOYEE	
	delete EMPLOYEE_SALARY
	
	delete EXPENSE
	
	delete COMPANY
	where COMPANY_ID!=1;
	
	delete BRANCH
	where BRANCH_ID!=1;  
  
	delete USER_LOGIN_HISTORY

	delete SM_MENU_ASSIGN
	where COMPANY_ID!=1;
	delete DS_FEATURE
	where COMPANY_ID!=1;
	delete DS_FEATURE_DETAILS
	where USER_ID!='king' AND USER_ID!='datasource'
	delete BRANCH 
	where COMPANY_ID!=1;
	
END;



-------------------------------------------------------------------------------------------------------
----------------------------Branch Database Reset-------------------------------



IF @RESET_CODE ='IBRAHIMRESET' AND @COMPANY_ID IS NOT NULL AND @BRANCH_ID IS NOT NULL
--IF @RESET_CODE ='IBRAHIM' AND @COMPANY_ID IS NOT NULL AND @BRANCH_ID =1 

BEGIN
delete ACCOUNT_LEDGER where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
update ACCOUNTS
set ACCOUNTS_BALANCE=0,opening_balance=0,OPENING_BALANCE_FLAG=0
where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete ADJUSTMENT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

update BUYER_SUPPLIER_INFO
set BS_ACCOUNT_BALANCE=0,
	OPENNING_BALANCE=0
where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete [COLLECTION] where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PAYMENT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

--select * from PRODUCT
update PRODUCT 
set STOCK_QUANTITY=0,
	PURCHASED_PRICE=0,
    TOTAL_STOCK_AMOUNT=0,
    OPENING_STOCK_QUANTITY=0,  
    OPENING_STOCK_AMOUNT=0    
where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete PRODUCT_SERIAL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PURCHASED_PRODUCT_SERIAL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PURCHASE_DETAILS where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PURCHASE where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete SALES_PRODUCT_SERIAL_CANCEL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete SALES_OTHER_INFO where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete SALES_PRODUCT_SERIAL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete SALES_DETAILS where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete SALES where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;


delete from SALES_DETAILS_EDIT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_OTHER_INFO_EDIT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_PRODUCT_SERIAL_EDIT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_EDIT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete from SALES_RETURN_DETAILS where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_OTHER_INFO_RETURN where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_RETURN_DETAILS_SERIAL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_RETURN where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete STOCK_TRANSFER_REQUEST_DETAILS where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete STOCK_TRANSFER_REQUEST where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;;

delete STOCK_TRANSFER_DETAILS_SERIAL where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;;
delete STOCK_TRANSFER_DETAILS where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;;
delete STOCK_TRANSFER where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;;


delete PRODUCT_SERIAL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete bank where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete ACCOUNTS where MANDATORY=0 and  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

--delete ACCOUNTS where MANDATORY=1 and  COMPANY_ID=@COMPANY_ID AND BRANCH_ID!=1;


delete dbo.PURCHASE_REQUISITION_DETAILS where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete dbo.PURCHASE_REQUISITION where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete dbo.PURCHASE_RETURN_DETAILS where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete dbo.PURCHASE_RETURN_DETAILS_SERIAL where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete dbo.PURCHASE_RETURN where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;


delete PRODUCTION.GENERATION_OF_PRODUCT_DETAILS where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PRODUCTION.GENERATION_OF_PRODUCT where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete PRODUCTION.GENERATION_OF_PRODUCT_SETUP where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PRODUCTION.GENERATION_OF_PRODUCT_SETUP_DETAILS where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete PRODUCTION.GENERATION_OF_PRODUCT_SETUP_DETAILS_HIST where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PRODUCTION.GENERATION_OF_PRODUCT_SETUP_HIST where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

update DS_SERIAL_GEN
set MAX_SERIAL_NO=0
WHERE  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

----SELECT * FROM DS_SERIAL_GEN WHERE TABLE_NAME IN ('PRODUCT','POD','POD','PRODUCT')
--DECLARE @CODE1 INT
--SELECT @CODE1 =SUBSTRING(CAST(MAX(CAST(PRODUCT_CODE AS INT)) AS NVARCHAR(30)),4,9) FROM PRODUCT
--where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
----SELECT @CODE 
--UPDATE DS_SERIAL_GEN
--SET MAX_SERIAL_NO=@CODE1
--WHERE COMPANY_ID=@COMPANY_ID and BRANCH_ID=@BRANCH_ID and TABLE_NAME IN ('PRODUCT','POD','POD','PRODUCT');


delete BUYER_SUPPLIER_INFO where MANDATORY=0 and   COMPANY_ID=@COMPANY_ID 
--AND BRANCH_ID=@BRANCH_ID;
delete EXPENSE where  COMPANY_ID=@COMPANY_ID 
delete BUYER_SUPPLIER_INFO where  COMPANY_ID=@COMPANY_ID AND BUYER_SUPPLIER_ID!=1;

--delete BRANCH where BRANCH_ID!=1 and COMPANY_ID=@COMPANY_ID;  
	
	
--	delete USER_PROFILE where COMPANY_ID!=1;

-- delete USER_PROFILE where USER_ID not in('king');


--delete PRODUCT 	where COMPANY_ID!=1 AND BRANCH_ID!=1;
	
--	delete PRODUCT 	where COMPANY_ID=1 AND BRANCH_ID!=1;
	
--	delete DS_FEATURE where BRANCH_ID!=1;
	
--	delete SM_MENU_ASSIGN where USER_ID not in('king');
--	delete SALES_PRODUCT_SERIAL ;

end;

	
-----------------------------------------------------------------------------------------

--//---------- Branch Delete Start-------------//



IF @RESET_CODE ='IBRAHIMBRANCHDEL' AND @COMPANY_ID IS NOT NULL AND @BRANCH_ID !=1 

BEGIN
delete ACCOUNT_LEDGER where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
update ACCOUNTS
set ACCOUNTS_BALANCE=0,opening_balance=0,OPENING_BALANCE_FLAG=0
where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete ADJUSTMENT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

update BUYER_SUPPLIER_INFO
set BS_ACCOUNT_BALANCE=0,
	OPENNING_BALANCE=0
where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete [COLLECTION] where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PAYMENT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

--select * from PRODUCT
update PRODUCT 
set STOCK_QUANTITY=0,
	PURCHASED_PRICE=0,
    TOTAL_STOCK_AMOUNT=0,
    OPENING_STOCK_QUANTITY=0,  
    OPENING_STOCK_AMOUNT=0    
where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete PRODUCT_SERIAL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PURCHASED_PRODUCT_SERIAL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PURCHASE_DETAILS where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PURCHASE where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete SALES_PRODUCT_SERIAL_CANCEL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete SALES_OTHER_INFO where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete SALES_PRODUCT_SERIAL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete SALES_DETAILS where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete SALES where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;


delete from SALES_DETAILS_EDIT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_OTHER_INFO_EDIT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_PRODUCT_SERIAL_EDIT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_EDIT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete from SALES_RETURN_DETAILS where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_OTHER_INFO_RETURN where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_RETURN_DETAILS_SERIAL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_RETURN where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete STOCK_TRANSFER_REQUEST_DETAILS where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete STOCK_TRANSFER_REQUEST where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;;

delete STOCK_TRANSFER_DETAILS_SERIAL where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;;
delete STOCK_TRANSFER_DETAILS where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;;
delete STOCK_TRANSFER where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;;


delete PRODUCT_SERIAL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete bank where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete ACCOUNTS where MANDATORY=0 and  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete ACCOUNTS where MANDATORY=1 and  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;


delete dbo.PURCHASE_REQUISITION_DETAILS where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete dbo.PURCHASE_REQUISITION where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete dbo.PURCHASE_RETURN_DETAILS where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete dbo.PURCHASE_RETURN_DETAILS_SERIAL where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete dbo.PURCHASE_RETURN where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;


delete PRODUCTION.GENERATION_OF_PRODUCT_DETAILS where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PRODUCTION.GENERATION_OF_PRODUCT where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete PRODUCTION.GENERATION_OF_PRODUCT_SETUP where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PRODUCTION.GENERATION_OF_PRODUCT_SETUP_DETAILS where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete PRODUCTION.GENERATION_OF_PRODUCT_SETUP_DETAILS_HIST where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PRODUCTION.GENERATION_OF_PRODUCT_SETUP_HIST where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

update DS_SERIAL_GEN
set MAX_SERIAL_NO=0
WHERE  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

--SELECT * FROM DS_SERIAL_GEN WHERE TABLE_NAME IN ('PRODUCT','POD','POD','PRODUCT')
--DECLARE @CODE1 INT
--SELECT @CODE1 =SUBSTRING(CAST(MAX(CAST(PRODUCT_CODE AS INT)) AS NVARCHAR(30)),4,9) FROM PRODUCT
--where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
--SELECT @CODE 
--UPDATE DS_SERIAL_GEN
--SET MAX_SERIAL_NO=@CODE1
--WHERE COMPANY_ID=@COMPANY_ID and TABLE_NAME IN ('PRODUCT','POD','POD','PRODUCT');


delete BUYER_SUPPLIER_INFO where MANDATORY=0 and   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete EXPENSE where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete BUYER_SUPPLIER_INFO where MANDATORY=1 and   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete BRANCH
	where BRANCH_ID=@BRANCH_ID and COMPANY_ID=@COMPANY_ID;  
	
	
	delete USER_PROFILE 
where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

--delete USER_PROFILE 
--where USER_ID not in('king');


delete PRODUCT
	where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
	
	--delete PRODUCT
	--where COMPANY_ID=1 AND BRANCH_ID!=1;
	
	delete DS_FEATURE where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
	
	delete SM_MENU_ASSIGN where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
	delete SALES_PRODUCT_SERIAL where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

end;

--//---------- Branch Delete Finish-------------//


	
-----------------------------------------------------------------------------------------

--//---------- Company Delete Start-------------//



IF @RESET_CODE ='IBRAHIMCOMPANYDEL' AND @COMPANY_ID!=1 

BEGIN
delete ACCOUNT_LEDGER where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
update ACCOUNTS
set ACCOUNTS_BALANCE=0,opening_balance=0,OPENING_BALANCE_FLAG=0
where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete ADJUSTMENT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

update BUYER_SUPPLIER_INFO
set BS_ACCOUNT_BALANCE=0,
	OPENNING_BALANCE=0
where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete [COLLECTION] where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PAYMENT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

--select * from PRODUCT
update PRODUCT 
set STOCK_QUANTITY=0,
	PURCHASED_PRICE=0,
    TOTAL_STOCK_AMOUNT=0,
    OPENING_STOCK_QUANTITY=0,  
    OPENING_STOCK_AMOUNT=0    
where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete PRODUCT_SERIAL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PURCHASED_PRODUCT_SERIAL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PURCHASE_DETAILS where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PURCHASE where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete SALES_PRODUCT_SERIAL_CANCEL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete SALES_OTHER_INFO where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete SALES_PRODUCT_SERIAL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete SALES_DETAILS where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete SALES where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;


delete from SALES_DETAILS_EDIT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_OTHER_INFO_EDIT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_PRODUCT_SERIAL_EDIT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_EDIT where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete from SALES_RETURN_DETAILS where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_OTHER_INFO_RETURN where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_RETURN_DETAILS_SERIAL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete from SALES_RETURN where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete STOCK_TRANSFER_REQUEST_DETAILS where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete STOCK_TRANSFER_REQUEST where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;;

delete STOCK_TRANSFER_DETAILS_SERIAL where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;;
delete STOCK_TRANSFER_DETAILS where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;;
delete STOCK_TRANSFER where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;;


delete PRODUCT_SERIAL where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete bank where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete ACCOUNTS where MANDATORY=0 and  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete ACCOUNTS where MANDATORY=1 and  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;


delete dbo.PURCHASE_REQUISITION_DETAILS where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete dbo.PURCHASE_REQUISITION where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete dbo.PURCHASE_RETURN_DETAILS where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete dbo.PURCHASE_RETURN_DETAILS_SERIAL where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete dbo.PURCHASE_RETURN where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;


delete PRODUCTION.GENERATION_OF_PRODUCT_DETAILS where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PRODUCTION.GENERATION_OF_PRODUCT where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete PRODUCTION.GENERATION_OF_PRODUCT_SETUP where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PRODUCTION.GENERATION_OF_PRODUCT_SETUP_DETAILS where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete PRODUCTION.GENERATION_OF_PRODUCT_SETUP_DETAILS_HIST where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete PRODUCTION.GENERATION_OF_PRODUCT_SETUP_HIST where   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

update DS_SERIAL_GEN
set MAX_SERIAL_NO=0
WHERE  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

--SELECT * FROM DS_SERIAL_GEN WHERE TABLE_NAME IN ('PRODUCT','POD','POD','PRODUCT')
--DECLARE @CODE1 INT
--SELECT @CODE1 =SUBSTRING(CAST(MAX(CAST(PRODUCT_CODE AS INT)) AS NVARCHAR(30)),4,9) FROM PRODUCT
--where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
--SELECT @CODE 
--UPDATE DS_SERIAL_GEN
--SET MAX_SERIAL_NO=@CODE1
--WHERE COMPANY_ID=@COMPANY_ID and TABLE_NAME IN ('PRODUCT','POD','POD','PRODUCT');


delete BUYER_SUPPLIER_INFO where MANDATORY=0 and   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete EXPENSE where  COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
delete BUYER_SUPPLIER_INFO where MANDATORY=1 and   COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

delete BRANCH
	where BRANCH_ID=@BRANCH_ID and COMPANY_ID=@COMPANY_ID;  
	
	
	delete USER_PROFILE 
where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;

--delete USER_PROFILE 
--where USER_ID not in('king');


delete PRODUCT
	where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
	
	--delete PRODUCT
	--where COMPANY_ID=1 AND BRANCH_ID!=1;
	
	delete DS_FEATURE where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
	
	delete SM_MENU_ASSIGN where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
	delete SALES_PRODUCT_SERIAL where COMPANY_ID=@COMPANY_ID AND BRANCH_ID=@BRANCH_ID;
	
	
	
	delete PRODUCT
	where COMPANY_ID!=1;
	
	delete PRODUCT
	where BRANCH_ID!=1;

	delete PRODUCT_BRAND
	where COMPANY_ID!=1;
	delete PRODUCT_SUBCATEGORY
	where COMPANY_ID!=1;
	delete PRODUCT_CATEGORY
	where COMPANY_ID!=1;
	delete PROFESSION
	where COMPANY_ID!=1

	delete ZONE
	where COMPANY_ID!=1
	delete INVOICE_NOTES
	where COMPANY_ID!=1
	delete COUNTRY
	where COMPANY_ID!=1
	delete DISTRICT
	where COMPANY_ID!=1
	delete PRODUCT_UNIT_TYPES
	where COMPANY_ID!=1

	delete ACCOUNT_SUBSIDIARY
	where COMPANY_ID!=1
	delete CONTROL_ACCOUNT
	where COMPANY_ID!=1
	
	delete EMPLOYEE	
	delete EMPLOYEE_SALARY
	
	delete EXPENSE
	
	delete COMPANY
	where COMPANY_ID!=1;
	
	delete BRANCH
	where BRANCH_ID!=1;  
  
	delete USER_LOGIN_HISTORY

	delete SM_MENU_ASSIGN
	where COMPANY_ID!=1;
	delete DS_FEATURE
	where COMPANY_ID!=1;
	delete DS_FEATURE_DETAILS
	where USER_ID!='king' AND USER_ID!='datasource'
	delete BRANCH 
	where COMPANY_ID!=1;

end;

--//---------- Company Delete Finish-------------//