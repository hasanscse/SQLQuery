


ALTER proc [dbo].[FSP_PRODUCT_U]

(
 @PRODUCT_CODE varchar(50),
 @PRODUCT_STATUS int,
 @WARRANTY_DAYS int, 
 @SALES_PRICE decimal(18, 2), 
 @PURCHASE_PRICE decimal(18, 2), 
 @SERIAL_AVAILABLE int, 
 @UNIT_ID int, 
 @UNIT_ID_SECONDARY int, 
 @CATEGORY_ID int, 
 @BRAND_ID int, 
 @SUBCATEGORY_ID int, 
 @COMPANY_ID VARCHAR (10),
 @BRANCH_ID VARCHAR (10),
 @PRODUCT_DESCRIPTION varchar(350),
 @PRODUCT_NAME varchar(250),
 @SALES_VAT decimal(18, 2),
 @RAW_MATERIALS_STATUS int,
 @DISCOUNT DECIMAL(18,2),
 @BUYER_SUPPLIER_ID nvarchar(30),
 @REORDER_LEVEL DECIMAL(18,3),
 @PRODUCT_IMAGE	image,
 @PRODUCT_SIZE_NAME varchar(350),
 @PRODUCT_COLOR_NAME varchar(350),
 @STYLE_CODE varchar(350),
@DISCOUNT_STATUS int,
@RACK_NO varchar(350),
 @TILES_SFT DECIMAL(18,2),
 @BOX_TILES DECIMAL(18,2),
 @WHOLESALES_PRICE DECIMAL(18,2),
 @STOCK_QUANTITY DECIMAL(18,2)
)
AS

UPDATE PRODUCT
   SET PRODUCT_NAME = @PRODUCT_NAME
      ,PRODUCT_DESCRIPTION = @PRODUCT_DESCRIPTION
      ,SUBCATEGORY_ID = @SUBCATEGORY_ID
      ,BRAND_ID = @BRAND_ID
      ,CATEGORY_ID = @CATEGORY_ID
      ,UNIT_ID = @UNIT_ID
      ,UNIT_ID_SECONDARY = @UNIT_ID_SECONDARY
      ,SERIAL_AVAILABLE = @SERIAL_AVAILABLE
      ,PURCHASE_PRICE = @PURCHASE_PRICE
      ,SALES_PRICE = @SALES_PRICE
      ,WARRANTY_DAYS = @WARRANTY_DAYS
      --,COMPANY_ID=@COMPANY_ID
      ,PRODUCT_STATUS = @PRODUCT_STATUS 
      ,SALES_VAT = @SALES_VAT
      ,RAW_MATERIALS_STATUS=@RAW_MATERIALS_STATUS
      ,DISCOUNT=@DISCOUNT
      ,BUYER_SUPPLIER_ID=@BUYER_SUPPLIER_ID
      ,REORDER_LEVEL=@REORDER_LEVEL
      ,PRODUCT_IMAGE=@PRODUCT_IMAGE
      ,PRODUCT_SIZE_NAME= @PRODUCT_SIZE_NAME ,
 PRODUCT_COLOR_NAME = @PRODUCT_COLOR_NAME,
 STYLE_CODE=@STYLE_CODE, DISCOUNT_STATUS =@DISCOUNT_STATUS,RACK_NO=@RACK_NO
 ,TILES_SFT=@TILES_SFT,BOX_TILES=@BOX_TILES,WHOLESALES_PRICE=@WHOLESALES_PRICE
 WHERE PRODUCT_CODE=@PRODUCT_CODE and COMPANY_ID=@COMPANY_ID 
 --and BRANCH_ID=@COMPANY_ID
 
 
  
 DECLARE @PRODUCT_QUANTITY decimal(18, 2)
	SET @PRODUCT_QUANTITY =(SELECT STOCK_QUANTITY FROM PRODUCT WHERE PRODUCT_CODE=@PRODUCT_CODE and COMPANY_ID=@COMPANY_ID and BRANCH_ID=@BRANCH_ID) 
 DECLARE @PRODUCT_OPENING_QUANTITY decimal(18, 2)
	SET @PRODUCT_OPENING_QUANTITY =(SELECT OPENING_STOCK_QUANTITY FROM PRODUCT WHERE PRODUCT_CODE=@PRODUCT_CODE and COMPANY_ID=@COMPANY_ID and BRANCH_ID=@BRANCH_ID) 
 IF(@PRODUCT_QUANTITY=0 AND @PRODUCT_OPENING_QUANTITY=0)
 BEGIN
 UPDATE PRODUCT
 SET
 PURCHASED_PRICE = @PURCHASE_PRICE,
 STOCK_QUANTITY = @STOCK_QUANTITY,
 OPENING_STOCK_QUANTITY= @STOCK_QUANTITY,
 TOTAL_STOCK_AMOUNT = (@PURCHASE_PRICE*@STOCK_QUANTITY),
 OPENING_STOCK_AMOUNT = (@PURCHASE_PRICE*@STOCK_QUANTITY)
 WHERE PRODUCT_CODE=@PRODUCT_CODE and COMPANY_ID=@COMPANY_ID and BRANCH_ID=@BRANCH_ID
 END
 